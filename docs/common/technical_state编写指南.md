# 技术现状文档 - AI维护指南

## 触发更新时机
- ✅ 代码合并到主分支后立即更新
- ✅ 架构师要求更新时
- ✅ 依赖项升级后
- ✅ 新模块上线/模块下线时
- ❌ 开发分支中的临时代码不更新

## 数据来源规范
| 章节 | 数据来源 | 更新频率 |  
|------|----------|----------|  
| 1.1 技术栈 | `package.json` / `requirements.txt` / 配置文件 | 依赖变更时 |  
| 1.2 关键依赖 | 同上 + 架构师已知问题 | 依赖变更时 |  
| 2.1 分层结构 | 架构设计文档 + 实际代码结构 | 架构调整时 |  
| 2.2 架构约束 | 架构设计文档 + 监控数据(当前峰值) | 月度或需求变更时 |  
| 3.1-3.3 数据模型 | 数据库Schema文件 + ORM模型定义 | 数据库迁移时 |  
| 4.1-4.2 模块清单 | **代码扫描结果** + Git历史 + 测试报告 | 每次代码合并时 |  
| 5 核心接口 | 代码注释/文档字符串 + 调用关系分析 | 接口新增/变更时 |  
| 6 性能与成本 | 监控系统数据 + 云平台账单 | 月度 |  

## 关键更新规则

### 模块状态判定
✅已完成: 功能完整 + 测试覆盖率≥80% + 无P0/P1技术债
🚧开发中: 功能未完整 OR 测试覆盖率<80%
⚠️有问题: 存在P0/P1技术债

### 技术债优先级标记
- 🔥 P0 (阻塞): 影响核心功能/安全漏洞
- ⚠️ P1 (重要): 性能问题/用户体验缺陷
- 💡 P2 (优化): 代码质量/可维护性改进

### "待完成"清单维护
- 仅记录本模块内的剩余工作
- 每项用动词开头，具体可执行
- 完成后立即删除该项，若全部完成则删除整个"待完成"小节


## 强制约束
### 一致性检查
模块的依赖关系必须与代码实际import一致
实体关系必须与数据库外键约束一致
测试覆盖率从实际测试报告提取，不得估算

### 简洁性原则
功能描述限制在20字内
每个模块的"关键文件"不超过5个
"核心接口"章节仅记录被3个以上模块调用的接口

### 禁止内容
❌ 不写具体代码实现细节(算法逻辑)
❌ 不写"将来可能"的计划(那是task_map的职责)
❌ 不写用户需求背景(那是项目基本面的职责)


## 冲突处理
### 遇到不确定的信息时

- 在对应字段标注 {待确认}
- 在文档末尾添加 ## 待确认项 清单
- 通知架构师进行人工确认

### 发现与其他文档矛盾时
本文档描述现状，以实际代码为准
若发现代码实现与task_map的计划不符 → 通知架构师

## 自检清单
更新后运行以下检查:
- 所有 {占位符} 已替换为实际内容
- 依赖关系无孤立模块(被依赖字段不为空)
- 数据模型的存储方案有对应schema定义
- 技术债都带有issue编号
